let makesAndModels={};async function loadMakesAndModels(){try{let e=await fetch(`/${countryCode}/js/makes-and-models.json`);if(!e.ok)throw Error("Failed to load make/model data");makesAndModels=await e.json(),console.log("Makes and models loaded:",makesAndModels)}catch(t){console.error("Error loading makes.json:",t)}}async function initializeSearch(){await loadMakesAndModels(),setupSearch()}function setupSearch(){let e=document.getElementById("search"),t=document.getElementById("dropdown");e.addEventListener("focus",handleInputFocus),document.addEventListener("click",function(s){e.contains(s.target)||t.contains(s.target)||t.classList.add("hidden")}),e.addEventListener("keydown",function(e){"Enter"===e.key&&selectFirstOption()})}function filterOptions(e){let t=document.getElementById("dropdown");t.innerHTML="";let s=e.value.toLowerCase().trim(),o=s.split(/\s+/).filter(e=>e.length>0),n=!1,l=[],a=[];if(o.length>0){let d=o[0],i=null;for(let r of Object.keys(makesAndModels))if(r.toLowerCase().startsWith(d)){i=r;break}if(i){let c=makesAndModels[i];l.push({make:i,model:"",displayText:`All ${i} models`}),c.forEach(e=>{let t=o.slice(1).every(t=>e.toLowerCase().startsWith(t)),s=o.slice(1).every(t=>e.toLowerCase().includes(t));t?l.push({make:i,model:e,displayText:`${i} ${e}`}):s&&a.push({make:i,model:e,displayText:`${i} ${e}`})})}else for(let[h,p]of Object.entries(makesAndModels)){let u=o.some(e=>h.toLowerCase().startsWith(e)),m=o.some(e=>h.toLowerCase().includes(e));u?l.push({make:h,model:"",displayText:`All ${h} models`}):m&&a.push({make:h,model:"",displayText:`All ${h} models`}),p.forEach(e=>{let t=o.some(t=>e.toLowerCase().startsWith(t)),s=o.some(t=>e.toLowerCase().includes(t));u||t?l.push({make:h,model:e,displayText:`${h} ${e}`}):(m||s)&&a.push({make:h,model:e,displayText:`${h} ${e}`})})}}let f=[...l,...a];f.length>0&&(n=!0,f.forEach(({make:e,model:t,displayText:o})=>{let n=highlightMatch(o,s);addDropdownOption(n,e,t)})),n?t.classList.remove("hidden"):t.classList.add("hidden")}function addDropdownOption(e,t,s=""){let o=document.getElementById("dropdown"),n=document.createElement("div");n.className="px-4 py-2 cursor-pointer hover:bg-gray-100 text-zinc-950",n.innerHTML=e,n.dataset.make=t,n.dataset.model=s,n.onclick=()=>selectOption(t,s),o.appendChild(n)}function highlightMatch(e,t){if(!t)return e;let s=e.toLowerCase(),o=t.toLowerCase(),n=s.indexOf(o);if(-1===n)return e;let l=n+t.length;return e.substring(0,n)+"<strong>"+e.substring(n,l)+"</strong>"+e.substring(l)}function selectFirstOption(){let e=document.querySelector("#dropdown div");if(e){let t=e.dataset.make,s=e.dataset.model;selectOption(t,s)}}function selectOption(e,t){let s=t?`${e}/${t}/`:`${e}/all/`;window.location.href=`/${countryCode}/${s}`}function resetField(){let e=document.getElementById("search");e.value="",document.getElementById("dropdown").classList.add("hidden")}function handleInputFocus(e){resetField(),filterOptions(e)}document.addEventListener("DOMContentLoaded",initializeSearch);
